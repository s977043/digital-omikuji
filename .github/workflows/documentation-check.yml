name: Documentation Check

on:
  pull_request:
    types: [opened, synchronize, reopened]
    paths:
      - 'app/**'
      - 'scripts/**'
      - 'package.json'
      - 'README.md'
      - 'documents/**'

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  documentation-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Check for code changes that require documentation updates
      run: |
        echo "ğŸ” Checking for code changes that might require documentation updates..."
        
        # Get changed files
        CHANGED_FILES=$(git diff --name-only origin/main...HEAD)
        echo "Changed files: $CHANGED_FILES"
        
        # Check if any source code files changed
        CODE_CHANGED=false
        for file in $CHANGED_FILES; do
          if [[ $file == app/* ]] || [[ $file == scripts/* ]] || [[ $file == package.json ]]; then
            CODE_CHANGED=true
            echo "ğŸ“ Code change detected: $file"
          fi
        done
        
        # Check if documentation was updated
        DOC_CHANGED=false
        for file in $CHANGED_FILES; do
          if [[ $file == README.md ]] || [[ $file == documents/* ]]; then
            DOC_CHANGED=true
            echo "ğŸ“š Documentation change detected: $file"
          fi
        done
        
        echo "CODE_CHANGED=$CODE_CHANGED" >> $GITHUB_ENV
        echo "DOC_CHANGED=$DOC_CHANGED" >> $GITHUB_ENV
    
    - name: Run documentation verification script
      run: npm run check-docs
    
    - name: Warn if documentation might need updates
      if: env.CODE_CHANGED == 'true' && env.DOC_CHANGED == 'false'
      run: |
        echo "âš ï¸ Warning: Code changes detected but no documentation updates found."
        echo "Please consider updating:"
        echo "- README.md if new features, installation steps, or usage changed"
        echo "- documents/ files if APIs, architecture, or processes changed"
        echo ""
        echo "This is a reminder - the PR can still be merged if documentation updates are not needed."
        
    - name: Comment on PR if documentation might need updates
      if: env.CODE_CHANGED == 'true' && env.DOC_CHANGED == 'false'
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: `## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ã®ç¢ºèª

ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸãŒã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°ãŒç¢ºèªã§ãã¾ã›ã‚“ã§ã—ãŸã€‚

ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°ãŒå¿…è¦ã‹ç¢ºèªã—ã¦ãã ã•ã„ï¼š

- **README.md** - æ–°æ©Ÿèƒ½ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †ã€ä½¿ç”¨æ–¹æ³•ã«å¤‰æ›´ãŒã‚ã‚‹å ´åˆ
- **documents/ ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«** - APIã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ãƒ—ãƒ­ã‚»ã‚¹ã«å¤‰æ›´ãŒã‚ã‚‹å ´åˆ

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°ãŒä¸è¦ãªå ´åˆã¯ã€ã“ã®PRã¯ãã®ã¾ã¾ãƒãƒ¼ã‚¸ã§ãã¾ã™ã€‚

---
*ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚Šä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚*`
          });