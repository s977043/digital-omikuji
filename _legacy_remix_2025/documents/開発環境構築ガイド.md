# 開発環境構築ガイド

## 概要

digital-omikuji プロジェクトの開発環境を構築するための詳細なガイドです。VibeCoding と Gemini CLI を使用した効率的な開発環境の構築方法を説明します。

## 必要な環境

### システム要件

- **OS**: macOS 10.15+, Ubuntu 18.04+, Windows 10+
- **Node.js**: 18.0.0 以上
- **npm**: 8.0.0 以上
- **Docker**: 20.10.0 以上
- **Docker Compose**: 2.0.0 以上
- **Git**: 2.30.0 以上

### 推奨スペック

- **CPU**: 4コア以上
- **メモリ**: 8GB 以上
- **ストレージ**: 10GB 以上の空き容量

## 基本環境の構築

### 1. Node.js のインストール

#### macOS (Homebrew使用)
```bash
brew install node@18
brew link node@18
```

#### Ubuntu
```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
```

#### Windows
[Node.js公式サイト](https://nodejs.org/)からインストーラーをダウンロード

### 2. Docker のインストール

#### macOS
```bash
brew install --cask docker
```

#### Ubuntu
```bash
sudo apt-get update
sudo apt-get install docker.io docker-compose
sudo usermod -aG docker $USER
```

#### Windows
[Docker Desktop](https://www.docker.com/products/docker-desktop/)をインストール

### 3. プロジェクトのセットアップ

```bash
# リポジトリのクローン
git clone https://github.com/s977043/digital-omikuji.git
cd digital-omikuji

# 依存関係のインストール
npm install

# 環境設定ファイルの作成
cp .env.example .env.local
```

## VibeCoding の設定

### 1. VibeCoding のインストール

```bash
# VibeCoding CLI のインストール
npm install -g vibe-coding-cli

# プロジェクトの初期化
vibe init --project-type remix --language typescript
```

### 2. 設定ファイルの作成

`.vibeconfig.json` を作成：

```json
{
  "project": {
    "name": "digital-omikuji",
    "type": "remix",
    "language": "typescript",
    "framework": "react"
  },
  "development": {
    "server": {
      "port": 3000,
      "host": "0.0.0.0"
    },
    "hotReload": true,
    "sourceMap": true,
    "watch": {
      "extensions": ["ts", "tsx", "js", "jsx", "css", "md"],
      "exclude": ["node_modules", "build", ".git"]
    }
  },
  "ai": {
    "provider": "gemini",
    "model": "gemini-pro",
    "temperature": 0.7,
    "maxTokens": 4096
  },
  "codeGeneration": {
    "templates": {
      "component": "templates/component.tsx.template",
      "test": "templates/test.tsx.template",
      "page": "templates/page.tsx.template"
    },
    "outputPaths": {
      "components": "app/components",
      "tests": "app/tests",
      "pages": "app/routes"
    }
  },
  "linting": {
    "enabled": true,
    "rules": "@remix-run/eslint-config",
    "autofix": true
  },
  "testing": {
    "framework": "jest",
    "testMatch": ["**/__tests__/**/*.test.{ts,tsx}"],
    "coverage": {
      "enabled": true,
      "threshold": 80
    }
  }
}
```

### 3. テンプレートの作成

#### コンポーネントテンプレート

`templates/component.tsx.template` を作成：

```typescript
import { useState } from 'react';

interface {{componentName}}Props {
  // Props の型定義をここに記述
}

export function {{componentName}}(props: {{componentName}}Props) {
  // コンポーネントのロジックをここに記述
  
  return (
    <div className="{{kebabCase componentName}}">
      {/* JSX をここに記述 */}
    </div>
  );
}

export default {{componentName}};
```

#### テストテンプレート

`templates/test.tsx.template` を作成：

```typescript
import { render, screen } from '@testing-library/react';
import { {{componentName}} } from './{{componentName}}';

describe('{{componentName}}', () => {
  it('renders correctly', () => {
    render(<{{componentName}} />);
    // テストケースをここに記述
  });

  it('handles user interactions', () => {
    render(<{{componentName}} />);
    // インタラクションテストをここに記述
  });
});
```

## Gemini CLI の設定

### 1. Gemini CLI のインストール

```bash
npm install -g @google-ai/generative-ai-cli
```

### 2. 認証設定

```bash
# Google AI Studio でAPIキーを取得
# https://aistudio.google.com/app/apikey

# APIキーの設定
gemini config set api-key YOUR_API_KEY_HERE

# 設定の確認
gemini config list
```

### 3. プロジェクト設定

`.geminirc.json` を作成：

```json
{
  "project": {
    "name": "digital-omikuji",
    "description": "Remix を使用したデジタルおみくじアプリケーション",
    "language": "typescript",
    "framework": "remix",
    "testFramework": "jest"
  },
  "generation": {
    "codeStyle": "functional",
    "naming": "camelCase",
    "imports": "es6",
    "typescript": {
      "strict": true,
      "declarations": true
    }
  },
  "review": {
    "enabled": true,
    "rules": [
      "typescript-strict",
      "react-best-practices",
      "performance-optimization",
      "accessibility",
      "security"
    ],
    "autofix": true
  },
  "documentation": {
    "language": "japanese",
    "format": "markdown",
    "includeExamples": true
  }
}
```

## 開発ワークフロー

### 1. 日常的な開発フロー

```bash
# 1. 開発サーバーの起動
npm run dev

# 2. VibeCoding の起動（別ターミナル）
vibe dev --watch

# 3. コード生成
vibe generate component --name MyComponent

# 4. AI レビューの実行
gemini review --file app/routes/index.tsx

# 5. テストの実行
npm test
```

### 2. 新機能開発フロー

```bash
# 1. 新しいブランチの作成
git checkout -b feature/new-feature

# 2. コンポーネントの生成
vibe generate component --name NewFeature --props "title:string,onClick:()=>void"

# 3. テストの生成
gemini generate test --file app/components/NewFeature.tsx

# 4. 実装
# エディタでコードを編集

# 5. AI レビュー
gemini review --file app/components/NewFeature.tsx

# 6. テストの実行
npm test

# 7. コミット
git add .
git commit -m "feat: add new feature"
```

## 開発ツールの設定

### 1. VSCode 拡張機能

推奨拡張機能をインストール：

```bash
# 拡張機能一覧ファイルの作成
cat > .vscode/extensions.json << EOF
{
  "recommendations": [
    "ms-vscode.vscode-typescript-next",
    "bradlc.vscode-tailwindcss",
    "esbenp.prettier-vscode",
    "ms-vscode.vscode-eslint",
    "ms-vscode.vscode-jest",
    "formulahendry.auto-rename-tag",
    "christian-kohler.path-intellisense"
  ]
}
EOF
```

### 2. VSCode 設定

`.vscode/settings.json` を作成：

```json
{
  "typescript.preferences.importModuleSpecifier": "relative",
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "tailwindCSS.includeLanguages": {
    "typescript": "typescript",
    "typescriptreact": "typescriptreact"
  },
  "jest.autoRun": "watch",
  "files.associations": {
    "*.css": "tailwindcss"
  }
}
```

### 3. Git Hooks の設定

Husky を使用してコミット前チェックを設定：

```bash
# Husky のインストール
npm install --save-dev husky

# Pre-commit hook の設定
npx husky add .husky/pre-commit "npm run lint && npm test"

# Pre-push hook の設定
npx husky add .husky/pre-push "npm run build"
```

## デバッグ設定

### 1. VSCode デバッグ設定

`.vscode/launch.json` を作成：

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Launch via npm",
      "type": "node",
      "request": "launch",
      "cwd": "${workspaceFolder}",
      "runtimeExecutable": "npm",
      "runtimeArgs": ["run", "dev"]
    },
    {
      "name": "Debug Jest Tests",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/node_modules/.bin/jest",
      "args": ["--runInBand"],
      "console": "integratedTerminal",
      "internalConsoleOptions": "neverOpen"
    }
  ]
}
```

### 2. Chrome DevTools 連携

```bash
# Chrome DevTools でのデバッグ
node --inspect-brk node_modules/.bin/remix dev
```

## トラブルシューティング

### よくある問題と解決方法

1. **ポート競合エラー**
   ```bash
   # 使用中のポートを確認
   lsof -i :3000
   
   # 別のポートを使用
   PORT=3001 npm run dev
   ```

2. **依存関係エラー**
   ```bash
   # node_modules を削除して再インストール
   rm -rf node_modules package-lock.json
   npm install
   ```

3. **Docker エラー**
   ```bash
   # Docker のクリーンアップ
   docker system prune -f
   
   # Docker Compose の再起動
   docker-compose down && docker-compose up -d
   ```

## 参考資料

- [Remix 公式ドキュメント](https://remix.run/docs)
- [TypeScript ハンドブック](https://www.typescriptlang.org/docs/)
- [Tailwind CSS ドキュメント](https://tailwindcss.com/docs)
- [Jest テストフレームワーク](https://jestjs.io/docs/getting-started)