# ドキュメント更新システム

## 概要

このドキュメントは、digital-omikujiプロジェクトに実装されたドキュメント自動更新システムについて説明します。このシステムにより、コード変更時にドキュメントが最新の状態に保たれるよう自動的にチェックが行われます。

## システム構成

### 1. GitHub Actions ワークフロー

#### documentation-check.yml
- **実行タイミング**: プルリクエスト作成時・更新時
- **対象ファイル**: `app/**`, `scripts/**`, `package.json`, `README.md`, `documents/**`
- **機能**: 
  - コード変更とドキュメント更新の同期チェック
  - ドキュメント更新が必要な場合の自動コメント作成

### 2. ドキュメント検証スクリプト

#### scripts/check-documentation.js
- **実行コマンド**: `npm run check-docs`
- **機能**:
  - README.mdの内容チェック
  - documents/フォルダの整合性確認
  - Gemini設定とドキュメントの同期確認
  - 新しいnpmスクリプトのドキュメント記載確認

### 3. Gemini CLI 指示ファイル

#### instructions/check-docs-update.json
- **実行コマンド**: `npm run gemini:check-docs`
- **機能**: Geminiを使用してコード変更に基づくドキュメント更新必要性の分析

#### instructions/check-readme-update.json
- **実行コマンド**: `npm run gemini:check-readme`
- **機能**: README.mdの更新が必要かどうかの確認と更新提案

#### instructions/pr-docs-review.json
- **実行コマンド**: `npm run gemini:pr-docs-review`
- **機能**: プルリクエストレビュー時のドキュメント状況チェック

## 使用方法

### 開発者向け

#### 日常的なドキュメントチェック
```bash
# 基本的なドキュメント状態確認
npm run check-docs

# AIを使用した詳細分析
npm run gemini:check-docs
npm run gemini:check-readme
```

#### プルリクエスト作成前
```bash
# PRレビュー用のドキュメントチェック
npm run gemini:pr-docs-review
```

### 自動実行

#### GitHub Actions
- プルリクエスト作成時に自動実行
- コード変更があってもドキュメント更新がない場合、警告コメントを作成
- 検証結果はPRのチェック項目として表示

## チェック項目

### README.mdチェック
- [ ] 新しいnpmスクリプトの記載
- [ ] 必須セクション（概要、使用技術、機能、使い方、開発方法）の存在
- [ ] 内部リンクの有効性

### documents/フォルダチェック
- [ ] 必要なドキュメントファイルの存在
- [ ] ファイルの更新日とpackage.jsonの更新日の比較
- [ ] ドキュメント間の一貫性

### Gemini設定チェック
- [ ] .geminirc.jsonのドキュメント設定確認
- [ ] ドキュメント関連指示ファイルの存在

## 設定ファイル

### .geminirc.json
```json
{
  "documentation": {
    "language": "japanese",
    "format": "markdown",
    "includeExamples": true,
    "autoUpdate": {
      "enabled": true,
      "checkOnCodeChange": true,
      "validateReadme": true,
      "validateApiDocs": true
    }
  },
  "review": {
    "documentationChecks": {
      "enabled": true,
      "checkReadmeSync": true,
      "checkApiDocSync": true,
      "validateDocStructure": true,
      "requireDocumentationForNewFeatures": true
    }
  }
}
```

## トラブルシューティング

### よくある問題

#### 1. 新しいスクリプトが認識されない
**症状**: 新しく追加したnpmスクリプトがドキュメントチェックで警告される
**解決方法**: README.mdの該当セクションにスクリプトの説明を追加

#### 2. Gemini CLI指示が実行されない
**症状**: `npm run gemini:*` コマンドでエラーが発生
**解決方法**: 
- Gemini CLIがインストールされているか確認
- `.geminirc.json`の設定を確認

#### 3. GitHub Actionsでドキュメントチェックが失敗する
**症状**: PRでドキュメントチェックが失敗する
**解決方法**:
- ローカルで `npm run check-docs` を実行して問題を特定
- 指摘された項目を修正してからPRを更新

## カスタマイズ

### チェック項目の追加
`scripts/check-documentation.js`を編集して、独自のチェック項目を追加できます。

### Gemini指示の修正
`instructions/`フォルダ内のJSONファイルを編集して、Geminiの動作をカスタマイズできます。

### GitHub Actions設定の変更
`.github/workflows/documentation-check.yml`を編集して、実行条件やチェック内容を変更できます。

## 今後の拡張予定

- [ ] ドキュメントの自動生成機能
- [ ] より詳細なAPI仕様書との同期チェック
- [ ] 多言語ドキュメント対応
- [ ] ドキュメント品質スコアの導入